<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JJMOVIES - Buscar</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="header">
    <div class="logo">JJMOVIES</div>
    <div class="nav-links">
      <a href="index.html">← Volver</a>
    </div>
  </header>

  <main class="search-page">
    <h1>Resultados para: <span id="searchQuery"></span></h1>
    <div id="searchResults" class="category-slider"></div>
  </main>

  <script src="script.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q');
    document.getElementById("searchQuery").textContent = query;

    async function searchMovies() {
      try {
        const url = `${BASE_URL}/search/multi?api_key=${API_KEY}&language=es-ES&query=${encodeURIComponent(query)}&page=1`;
        const res = await fetch(url);
        const data = await res.json();

        const results = document.getElementById("searchResults");
        results.innerHTML = "";

        (data.results || []).slice(0, 30).forEach(item => {
          const card = document.createElement("div");
          card.className = "movie-card";
          card.onclick = () => window.location.href = `details.html?id=${item.id}&type=${item.media_type}`;

          const poster = item.poster_path ? IMG_BASE + item.poster_path : "https://via.placeholder.com/200x280/222/aaa?text=—";
          const isFavorite = myList.some(fav => fav.id === item.id && fav.type === item.media_type);

          card.innerHTML = `
            <img class="poster" src="${poster}" alt="${item.title || item.name}" loading="lazy" />
            <div class="card-title">${item.title || item.name}</div>
            <button class="favorite-btn" onclick="toggleFavorite(event, ${item.id}, '${item.media_type}')">
              ${isFavorite ? "❤️" : "♡"}
            </button>
          `;
          results.appendChild(card);
        });
      } catch (err) {
        console.error("Error en búsqueda", err);
        document.body.innerHTML = "<h1>Error al buscar.</h1>";
      }
    }

    if (query) {
      searchMovies();
    } else {
      document.body.innerHTML = "<h1>Ingresa un término de búsqueda.</h1>";
    }
  </script>
</body>
</html>
