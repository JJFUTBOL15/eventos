<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JJMOVIES - Detalles</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="header">
    <div class="logo">JJMOVIES</div>
    <div class="nav-links">
      <a href="index.html">‚Üê Volver</a>
    </div>
  </header>

  <main class="details-page">
    <!-- Imagen completa con botones encima -->
    <div class="details-banner" id="detailsBanner">
      <div class="banner-overlay">
        <h1 id="detailsTitle"></h1>
        <div class="details-meta">
          <span id="detailsYear"></span> ‚Ä¢ 
          <span id="detailsGenres"></span> ‚Ä¢ 
          <span id="detailsRuntime"></span>
        </div>
        <div class="details-actions">
          <button id="playBtn" class="btn-play">‚ñ∂ Ver ahora</button>
          <button id="favoriteBtn" class="btn-info">‚ô° A√±adir a Mi Lista</button>
          <a href="https://t.me/+6MfwQuRHO_Q3NTIx" target="_blank" class="telegram-btn">üí¨ Telegram</a>
        </div>
      </div>
    </div>

    <!-- Sinopsis -->
    <div class="details-overview-container">
      <p id="detailsOverview"></p>
    </div>

    <!-- Temporadas (solo para series) -->
    <div id="seasonsSection" class="seasons-section"></div>
  </main>

  <script src="script.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    const type = urlParams.get('type');

    let totalSeasons = 0;

    // Cargar detalles
    async function loadDetails() {
      try {
        const url = `${BASE_URL}/${type}/${id}?api_key=${API_KEY}&language=es-ES`;
        const res = await fetch(url);
        const data = await res.json();

        // Mostrar banner
        const bannerUrl = data.backdrop_path ? IMG_BASE + data.backdrop_path : "https://via.placeholder.com/1920x800/222/aaa?text=Sin+imagen";
        document.getElementById("detailsBanner").style.backgroundImage = `url(${bannerUrl})`;

        // T√≠tulo
        document.getElementById("detailsTitle").textContent = data.title || data.name;

        // Metadatos
        if (type === 'movie') {
          document.getElementById("detailsYear").textContent = data.release_date?.substring(0,4) || "???";
          document.getElementById("detailsRuntime").textContent = `${data.runtime || 0} min`;
        } else {
          document.getElementById("detailsYear").textContent = `${data.first_air_date?.substring(0,4) || "???"} - ${data.last_air_date?.substring(0,4) || "???"}`;
          document.getElementById("detailsRuntime").textContent = data.number_of_episodes ? `${data.number_of_episodes} episodios` : "";
          totalSeasons = data.number_of_seasons || 0;
        }

        document.getElementById("detailsGenres").textContent = data.genres.map(g => g.name).join(", ") || "‚Äî";
        document.getElementById("detailsOverview").textContent = data.overview;

        // Configurar botones
        if (type === 'movie') {
          document.getElementById("playBtn").onclick = () => window.location.href = `watch.html?id=${id}&type=movie`;
        } else {
          // Para series, el bot√≥n "Ver ahora" reproduce S1E1
          document.getElementById("playBtn").onclick = () => window.location.href = `watch.html?id=${id}/1/1&type=tv`;
        }

        const favoriteBtn = document.getElementById("favoriteBtn");
        const isFavorite = myList.some(item => item.id === id && item.type === type);
        favoriteBtn.textContent = isFavorite ? "‚ù§Ô∏è A√±adido" : "‚ô° A√±adir a Mi Lista";
        favoriteBtn.onclick = () => {
          toggleFavorite(null, id, type);
          favoriteBtn.textContent = myList.some(item => item.id === id && item.type === type) ? "‚ù§Ô∏è A√±adido" : "‚ô° A√±adir a Mi Lista";
        };

        // Si es serie, cargar temporadas
        if (type === 'tv') {
          loadSeasons(id);
        }
      } catch (err) {
        console.error("Error al cargar detalles", err);
        document.body.innerHTML = "<h1>Error al cargar los detalles.</h1>";
      }
    }

    // Cargar temporadas
    async function loadSeasons(showId) {
      const seasonsSection = document.getElementById("seasonsSection");
      seasonsSection.innerHTML = "<h2>Temporadas</h2>";

      const grid = document.createElement("div");
      grid.className = "seasons-grid";

      for (let seasonNumber = 1; seasonNumber <= totalSeasons; seasonNumber++) {
        const seasonCard = document.createElement("div");
        seasonCard.className = "season-card";
        seasonCard.onclick = () => loadEpisodes(showId, seasonNumber);

        seasonCard.innerHTML = `
          <div class="season-number">Temporada ${seasonNumber}</div>
        `;
        grid.appendChild(seasonCard);
      }

      seasonsSection.appendChild(grid);
    }

    // Cargar episodios de una temporada
    async function loadEpisodes(showId, seasonNumber) {
      try {
        const url = `${BASE_URL}/tv/${showId}/season/${seasonNumber}?api_key=${API_KEY}&language=es-ES`;
        const res = await fetch(url);
        const data = await res.json();

        const seasonsSection = document.getElementById("seasonsSection");
        seasonsSection.innerHTML = `<h2>Temporada ${seasonNumber}: ${data.name || ''}</h2>`;

        const grid = document.createElement("div");
        grid.className = "episodes-grid";

        data.episodes.forEach(episode => {
          const epCard = document.createElement("div");
          epCard.className = "episode-card";
          epCard.onclick = () => {
            window.location.href = `watch.html?id=${showId}/${seasonNumber}/${episode.episode_number}&type=tv`;
          };

          epCard.innerHTML = `
            <div class="episode-number">E${episode.episode_number}</div>
            <div class="episode-title">${episode.name}</div>
          `;
          grid.appendChild(epCard);
        });

        seasonsSection.appendChild(grid);
      } catch (err) {
        console.error("Error al cargar episodios", err);
      }
    }

    if (id && type) {
      loadDetails();
    } else {
      document.body.innerHTML = "<h1>ID o tipo no v√°lido.</h1>";
    }
  </script>
</body>
</html>
